language: java
jdk:
  - openjdk8
services:
  - docker
env:
  global:
    - secure: OoyA/6fja1xFWM3qIyg8tsLCCun8aDFRyAMGNlQICyyfK7HDSkMy3EZz8iOzlULy0ozF1132JNUXP5F5q3M7UgasD9uW+GRYtqJF1QL7Xf2luG8QrPSjd9PpLb3wlTs5Q/AQwIbZOjzb60zXl+lVVTZ8/7sUkCgzlgbNisSsriQewzxgzznROmdx2QaiC3+TCF+s/qKAsNBDYRJJ2KENvB979kTz7sLiqFHGOuqSG4R8EXA5+RsvLH9+Zep0JkumFaaQs9nzs1aKRHrmei0iT5/NyPw9S+H5EUPW7Sf9hrNFg/BSqQWmuxfGvfYB19Y0Oon4FdhYRHZq1ZxS/p45yvFofD9YZEEv+hvRS8DNc2BA6aD/GRlS8xke4r7lZOAJ0C9yGFZtztZ6DBvXRF16YwOjFFnoSexrMoPCxaX4zUGGq70NHummAKuLPI5LxSwwUPq3uwOh6dMP4M0BKc5q4j5O7FgnQjUe73IYzyZwbEArk4QMprJw7DDvJImqyQFnY/Qa5ANaoyUMQQLH6LPjPSRtc/D2A2mUTvLhkCXnu8iZvRPfkXnFHKXA+Z+/bzHY5DYwsSNFQJK+NO1gogn7MneydCrRXQzF3MbIa/21gpAACi6XT2UuKnpt+JNZor/EgFjhN8t/RSFLqSTef8HiZVc3Li4wG2ch/WXykIQTfs0=
    - secure: fza+Gij0/Z0pNqxvP9VP+75MsK2D7tArPUiIgeikBuooh4QP4GPXkF05UH4d8070bQzVdjRQS/3E9RCN1XiHDdLRN8SfZlUKhxAWCEI9292DQrdxPdGjvYDDWOjNfmcvI9Z5Zq+DeSsWphaHAa1hT1Zg3/M2f/IfBFDQA3mnhn6QFAbDkR8HlENy+HvA5MYDN0z6n/YStPX9L72VU5iHGepS5DhsgV2ByJKQtsN8NtUpF8mIxR6z3CHrGwwAbcy1fbfv+/cVIxkFfXM9SRjwkOv4BjhFqqY17QLkQa3by5qEOOCpFuGkFquAnCnisW9ZrO9CrFzRsgDHBOY9Xsyd/knoPlOG+hsPUddfLv7YnKPg86wSF17CxAKuWzBZEWu7mIf6lrHGj4uDlaIC8UcxyQcQajUJmMuZH/5ZJn1rgXfbeGK91N8hxxzKaXEViHs2oHrL4Rx3lQCpxyNdSfjMrnltDB+Quq3bMWs1PX2g0nNfwbnk8TQZqICB5wy/nrmovoe9ugHUp1YJCk0hUZAlbMrN4EPva17LqRARjMrTOsogNuisU2lIqI1zSJrMG8eHwYTu5nZInGwbgfcSwKZ3zQijcMXM/PUmcgcDQXw1mVhbnW0R0l5ggg0PE7hW0aUd8kIiUqBzkXpEh1VdwngmvHvHCQOVpP942oMK+csXFC0=
    - secure: cYnBqTA4Bd5Q+3OLW77GylZnMcVkLrbID2p4zWRJXmqW6Duu5D9uynslbLk+mDZBXcQlgRgAmXNRHl83FBLfI49th7OFoyMHCnZSycEiDmaBbZLPr0iVKRKH04WntiMWaMDUSIH2hi/CTP6UGeMZfBI1JpCjxNeTuustf2CtGoTl35StiWwM8TQ5XSuK0gYQEo0UqGXK16mgwG7dHgLiASpSUWxQTEhoytt2GReKpxD/rXG9Xh3Qs+MLmHCdts0vX6ehMkbmjRUAEXMk8LBjFcp0LCAe9ZhaGzj7Vroh77fJABYT5Bo5TbhmVUlhgYHYU3z4ZgRhmbKZXZvyNgZ0InRIJVB3LjUk2iKak1fsbISTFf/MwT4LaRFshU0F6Xe8dFyApsvwoE6VReAIXgLfmUv23AdCnDbEipeCTAQuFCwvV56TPOiC7bLcgf2z0VFJBW3jr98ovhzr/M0HDd//zXZLKvyWFLzb6nMwv9SvHWnzv/tXdscl9bEnNMtlE5xIuvHSVgUseHB3GOGwFbku6XV0b1DkvUEq3iu2I23h3ewUCWEBrJTyrsrJgLqXwcoIU2rHRfKBUHXimBoioucLYupGG89gDjFUBbGpypYCTFlOlNvrHJl0G+BVFGlH19GWIukadJIch0zpSFbi+9DKBk2YjBNMvlGXLw1w9UZilA8=
    - secure: BgJ2tgi3wiFDLpXyFQ1zsO7v5VlqrcyGHq592YVq4II3rjjLctxcVnbSmts+r0AQIOvjb3wwcjEpbbrSM9zvOLVYF/7ltb6zjU+ISLlcH1LuuwjIEhKANtuhRBK0x4AWfPSEJKZxSmscH69933b6Jm3wTQrAXKMJcKW25qI0PAiuIZ+9fT/G518UDKnECbwacxRuxq2glQUOOBGuZWkA2eKKEb8Xr041JS7fHfLUlNvjnZEnW3M7LGqDhrnjtExnlfG0jcv6yxCagXzbf0F7hKqpYb0m1HVYviM7Qsd7NDPJ3ucRIpUFjS0Q8gob9Y42R+53CBTO44n7y7GzgeGJrU4GfGmD4CeXMwNCgPMH8fjSP2l4ZPUanlQMI6TDKOzrJOBGqMVDdl5q3/8FHxIqDbSTFmJO61iWoGgA4A49V/Fen+heyT5kJzoafY9/pTkzIukrMIW5TNNjWIpKxqTF7RN8kaC3byWrV34IOKIwmPi1fUq6frBWYdAd89nO3NWK+K7T5dyz6SMSFJXvu/JGQmDSJez9CdCJ2tbevPryVA4Yh9IZ01PQ77OpZwt5wbP8kHhgZHbtSYPdze7yHZj+W/qTN6sKr+iRupcI/lbvtfGbUsBx2fV73QG+WaeBUENVeU5JcBnDILo959m1BhlvWV9miWgl9IeKUgfwZ7rZOnk=
before_install:
  - docker pull openjdk:8-jdk-alpine
script:
  - mvn test
  - mvn clean package
after_success:
  - export COMMIT=${TRAVIS_COMMIT::7}
  - export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH--$COMMIT"; fi`
  - echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
  - docker-compose build
  - docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME:$TAG
  - export TITLE="$IMAGE_NAME:$TAG is built properly and pushed to Dockerhub"
  - export TIMESTAMP=`date`
  - export GIT_LOG=`git log -1 --pretty=%B $COMMIT`
  - export TEXT="[build version] $TAG<br />[datetime] $TIMESTAMP<br />[changelog] $GIT_LOG<br />"

deploy:
  provider: heroku
  api-key:
    secure: "$HEROKU_API_KEY"
  app: shopping-cart-api-mrl
  on:
    tags: true
    repo: MarlonFlorencio/shopping-cart-api
