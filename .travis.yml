language: java
jdk:
  - openjdk8
services:
  - docker
env:
  global:
    - secure: ipm0f9rnxl04RZIAcwQFyZu5fTUAIS/+Q8t5hU4Fyx9n3nO0izaqErz6K9F5vV66mofuDtUa32GUWCGrPu/HdmBwNi33Ra1tu06VkExLvtzNqxbGyoFhMNAb6+LHU9Ddl1bFlB2/gvek487aDshcz+1GR0YsMD6MbYMzoOpjGVvcEGDHpn9HpCLCymWheOdlv9ABla84F9gAAcPSkDP3bzSZJblbX48lrEL8SmnTnp2DoMKig/mWw0EjN5lvyPXiVBNxDqz2ikbONYpyUuKzQl8YQCp4A40Z8QfNxMHKsQvplGuIfFg4slXTbsnWIkKmZhlEJNivu9F280d/BFmbicq/a9X5zR18N8UUvj9INtT/nbErLE9MN/BB9wGtACQ4FwQh5YX8nSU3ZeDpkcZPzt/fAn0L5URlsJhCnAjLTtvyvC/QBuSaKxlFDkJd5CfSHRfRuhJRTSCiwKWN/BhnSDvqmn7pfq5IqMALM7QEnAkolPVbYb1I6dn4N0MQKcsBpMDnMxoaRPFpQko8KoJjAqRkGWwKGY+kQjOVWaACthM7iR4VoxtrSCCOnTiqAhXIXktiJIEboGiSSDFIyRTuEozjf5ik4nUQbeMZ54qfHdyzWKRaUVKkozZTHd2UHVnnretnGmoZBfiuB8WqNQ9KAPoMjeDvl9MbKTC4OR5M+c0=
    - secure: fza+Gij0/Z0pNqxvP9VP+75MsK2D7tArPUiIgeikBuooh4QP4GPXkF05UH4d8070bQzVdjRQS/3E9RCN1XiHDdLRN8SfZlUKhxAWCEI9292DQrdxPdGjvYDDWOjNfmcvI9Z5Zq+DeSsWphaHAa1hT1Zg3/M2f/IfBFDQA3mnhn6QFAbDkR8HlENy+HvA5MYDN0z6n/YStPX9L72VU5iHGepS5DhsgV2ByJKQtsN8NtUpF8mIxR6z3CHrGwwAbcy1fbfv+/cVIxkFfXM9SRjwkOv4BjhFqqY17QLkQa3by5qEOOCpFuGkFquAnCnisW9ZrO9CrFzRsgDHBOY9Xsyd/knoPlOG+hsPUddfLv7YnKPg86wSF17CxAKuWzBZEWu7mIf6lrHGj4uDlaIC8UcxyQcQajUJmMuZH/5ZJn1rgXfbeGK91N8hxxzKaXEViHs2oHrL4Rx3lQCpxyNdSfjMrnltDB+Quq3bMWs1PX2g0nNfwbnk8TQZqICB5wy/nrmovoe9ugHUp1YJCk0hUZAlbMrN4EPva17LqRARjMrTOsogNuisU2lIqI1zSJrMG8eHwYTu5nZInGwbgfcSwKZ3zQijcMXM/PUmcgcDQXw1mVhbnW0R0l5ggg0PE7hW0aUd8kIiUqBzkXpEh1VdwngmvHvHCQOVpP942oMK+csXFC0=
    - secure: cYnBqTA4Bd5Q+3OLW77GylZnMcVkLrbID2p4zWRJXmqW6Duu5D9uynslbLk+mDZBXcQlgRgAmXNRHl83FBLfI49th7OFoyMHCnZSycEiDmaBbZLPr0iVKRKH04WntiMWaMDUSIH2hi/CTP6UGeMZfBI1JpCjxNeTuustf2CtGoTl35StiWwM8TQ5XSuK0gYQEo0UqGXK16mgwG7dHgLiASpSUWxQTEhoytt2GReKpxD/rXG9Xh3Qs+MLmHCdts0vX6ehMkbmjRUAEXMk8LBjFcp0LCAe9ZhaGzj7Vroh77fJABYT5Bo5TbhmVUlhgYHYU3z4ZgRhmbKZXZvyNgZ0InRIJVB3LjUk2iKak1fsbISTFf/MwT4LaRFshU0F6Xe8dFyApsvwoE6VReAIXgLfmUv23AdCnDbEipeCTAQuFCwvV56TPOiC7bLcgf2z0VFJBW3jr98ovhzr/M0HDd//zXZLKvyWFLzb6nMwv9SvHWnzv/tXdscl9bEnNMtlE5xIuvHSVgUseHB3GOGwFbku6XV0b1DkvUEq3iu2I23h3ewUCWEBrJTyrsrJgLqXwcoIU2rHRfKBUHXimBoioucLYupGG89gDjFUBbGpypYCTFlOlNvrHJl0G+BVFGlH19GWIukadJIch0zpSFbi+9DKBk2YjBNMvlGXLw1w9UZilA8=
    - secure: BgJ2tgi3wiFDLpXyFQ1zsO7v5VlqrcyGHq592YVq4II3rjjLctxcVnbSmts+r0AQIOvjb3wwcjEpbbrSM9zvOLVYF/7ltb6zjU+ISLlcH1LuuwjIEhKANtuhRBK0x4AWfPSEJKZxSmscH69933b6Jm3wTQrAXKMJcKW25qI0PAiuIZ+9fT/G518UDKnECbwacxRuxq2glQUOOBGuZWkA2eKKEb8Xr041JS7fHfLUlNvjnZEnW3M7LGqDhrnjtExnlfG0jcv6yxCagXzbf0F7hKqpYb0m1HVYviM7Qsd7NDPJ3ucRIpUFjS0Q8gob9Y42R+53CBTO44n7y7GzgeGJrU4GfGmD4CeXMwNCgPMH8fjSP2l4ZPUanlQMI6TDKOzrJOBGqMVDdl5q3/8FHxIqDbSTFmJO61iWoGgA4A49V/Fen+heyT5kJzoafY9/pTkzIukrMIW5TNNjWIpKxqTF7RN8kaC3byWrV34IOKIwmPi1fUq6frBWYdAd89nO3NWK+K7T5dyz6SMSFJXvu/JGQmDSJez9CdCJ2tbevPryVA4Yh9IZ01PQ77OpZwt5wbP8kHhgZHbtSYPdze7yHZj+W/qTN6sKr+iRupcI/lbvtfGbUsBx2fV73QG+WaeBUENVeU5JcBnDILo959m1BhlvWV9miWgl9IeKUgfwZ7rZOnk=
before_install:
  - docker pull openjdk:8-jdk-alpine
script:
  - mvn test
  - mvn clean package
after_success:
  - export COMMIT=${TRAVIS_COMMIT::7}
  - export TAG=`if [ ! -z "$TRAVIS_TAG" ]; then echo "$TRAVIS_TAG"; else echo "$TRAVIS_BRANCH--$COMMIT"; fi`
  - echo "$DOCKER_PASS" | docker login -u "$DOCKER_USER" --password-stdin
  - docker-compose build
  - docker tag $IMAGE_NAME:latest $IMAGE_NAME:$TAG
  - docker push $IMAGE_NAME:$TAG
  - export TITLE="$IMAGE_NAME:$TAG is built properly and pushed to Dockerhub"
  - export TIMESTAMP=`date`
  - export GIT_LOG=`git log -1 --pretty=%B $COMMIT`
  - export TEXT="[build version] $TAG<br />[datetime] $TIMESTAMP<br />[changelog] $GIT_LOG<br />"

deploy:
  provider: heroku
  api-key:
    secure: "$HEROKU_API_KEY"
  app: shopping-cart-api-mf
  on:
    tags: true
    repo: MarlonFlorencio/shopping-cart-api
